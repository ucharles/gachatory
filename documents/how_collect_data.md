# 들어가기 전에

이런 것을 왜 만들려고 마음 먹었는지 궁금하다면 [여기](https://marshmelona.tistory.com/26)를 참조해 주세요.

## 캡슐 토이의 정의

플라스틱으로 만들어진 구체 캡슐 안에 담아 판매되는 장난감 등이다. 보통 뽑기 기계 안에 담겨 있고, 돈을 넣으면 장난감을 뽑을 수 있다.<br>
이런 상품을 캡슐 토이라 정의한다. 박스에 담긴 비슷한 상품은 캡슐 토이로 취급하지 않는다. 크레인 경품도 캡슐 토이로 취급하지 않는다.

# 정보를 어떻게 모을 것인가?

## 정보 흐름 파악하기

정보 흐름을 파악하기 전에 캡슐 토이의 유통과정을 간단히 알아보자.

1. 제조사에서 발매 정보를 미리 제공
2. 캡슐 토이를 판매하는 도소매 업자들 제조사에 수주
3. 도소매 업자들이 일반 고객에게 판매

정보를 수집할 수 있는 곳은 크게 제조사, 업자, 소비자로 나뉠 수 있겠다. <br>
이 분류 기준에 따라 정보 수집처를 정리해보면...

1. 제조사: 캡슐 토이 제조사의 자사 사이트 혹은 트위터
2. 도소매 업자: 도소매 업자의 통판 사이트
3. 소비자: 개인 블로그 혹은 트위터

정보를 수집할 곳을 파악했으니 하나씩 살펴보자.

## 제조사 파악하기

제조사 정보 수집을 마음먹고 찾아나섰을 때부터 쉽지 않았다. 보기 좋게 정보를 정리한 곳이 없었기 때문이다.<br>
우연히 내가 만들고자 하는 사이트와 [비슷한 곳](https://ota-goods.info/gacha/)을 찾아서 제조사에 대한 단서를 찾을 수 있었다.<br>
일본에만 대략 **60개**가 넘는 캡슐 토이 제조사(혹은 브랜드)가 있었다.

## 제조사가 너무 많은데...?

전략적인 접근이 필요하다는 생각이 들었다. 내가 만들고자 하는 것과 필요한 것, 모을 수 있는 것을 먼저 정리해야했다.<br>
처음부터 완벽할 수는 없다. 정보를 모으면서도 전략이 반드시 수정될 것이다. (실제로도 그랬다) 두려워 말고 하나하나 부딪혀야 한다.

# 어떤 정보가 필요한가

## 내가 만들고자 하는 것을 구체화하기

우선 만들고자 하는 것을 구체화했다. 이에 따라 데이터 수집 기준과 방법이 정해진다.

1. 캡슐 토이의 역사를 알 수 있는 곳
2. 캡슐 토이의 발매 예정 정보를 알 수 있는 곳

## 필요한 정보를 정리하기

1. 과거의 되도록 많은 자료가 필요함 (역사를 알 수 있을 정도)
2. 미래의 자료도 필요함
3. 상품명*, 제조사명*, 대표 이미지*, 상세 이미지, 발매 날짜* (재발매 포함*), 상품 설명, 가격*<br>
   (\*는 필수 요소)

## 어떤 정보를 수집할 수 있는지 파악하기

60개가 넘는 제조사를 일일히 확인하면서 어떤 정보를 수집할 수 있는지 확인해야 한다.<br>
앞으로 발매되는 상품의 정보뿐만 아니라 과거의 정보도 필요하기에 꼼꼼하게 조사해야 했다.<br>
양이 많기에 엑셀에 정보를 기입하면서 진행했다. 확인한 정보는 다음과 같다.

1. 자사 사이트가 있는지
2. 상품 정보(상품명, 대표 이미지)가 수집하기 좋게 게시되어 있는지
3. 재발매 정보가 있는지
4. 미래의 발매 정보가 미리 게시되어 있는지
5. 상세 이미지를 게시하는지

## 제조사별로 수집 전략 세우기

수집해야 하는 데이터의 종류는 크게 2가지다.

1. 지금 게시되어 있는 데이터
2. 앞으로 게시될 데이터

### 1. 지금 게시되어 있는 데이터

1. 자사 사이트에 발매 상품 목록을 게시하고 있다면 스크래핑 하면 된다.
2. 자사 사이트가 있지만 상품 목록이 없거나, 자사 사이트가 없으면 도매상 사이트에서 스크래핑 하면 된다.

### 2. 앞으로 게시될 데이터

문제는 앞으로 게시될 데이터이다. 매일 자동으로 데이터를 스크래핑하기 위해서 필요한 중요한 정보이다.<br>
자사 사이트에 자사 상품을 게시하는 제조사 사이트에는 2가지 패턴이 있다.

1. 미래 정보를 미리 게시하는 경우
2. 발매 되었거나 발매를 앞둔 상품을 게시하는 경우

#### 1. 미래 정보를 미리 게시하는 경우

미래 정보를 미리 게시하는 제조사 사이트는 자동 스크래핑 대상이 된다. 이 앱의 목적은 과거 제품을 모음과 동시에<br>
앞으로 발매될 제품의 정보를 한곳에서 편하게 보기 위함이니, 발매 예정 정보는 가치가 상당히 높고 스크래핑 우선 순위가 높아진다.

#### 2. 발매 되었거나 발매를 앞둔 상품을 게시하는 경우

발매 되었거나 발매를 앞둔 상품을 게시하는 경우는 스크래핑 우선 순위가 떨어진다.<br>
그 이유는 도매상 사이트에 발매 예정 상품 정보가 먼저 올라오기 때문이다.<br>
고화질 이미지나 혹은 상세 이미지가 필요하다면 나중에라도 스크래핑 하면 되겠지만 나중 얘기다.

# 데이터 수집 흐름

## 과거 데이터

되도록 자사 사이트에서 수집한다. 이유는 대표 이미지가 깨끗하고 완전하며 필수 정보가 거의 기재되어 있다.<br>
자사 사이트가 없다면 도매상 사이트나 직영 X(구 트위터)를 이용해야 하는데, 되도록 도매상 사이트를 이용한다.<br>
X(구 트위터)에서 되도록 데이터를 스크래핑하지 않는 이유는 다음과 같다.

1. 데이터 수집 자체가 예전보다 까다로워졌다.
2. 상품 정보를 담고 있는 게시물을 구분하기가 까다롭다.
3. 본문에서 필요한 상품 정보를 추출하기가 까다롭다.

결론: 약간이라도 인간의 손길이 필요하다. 공수가 들어간다. 지향점인 자동화와는 거리가 멀다.

## 미래 데이터 (자동 수집)

미래 상품을 미리 게시하는 경우, 대표 이미지가 누락되어 있을 수도 있다. 과거 데이터와는 수집 흐름이 약간 다르다.<br>
이 흐름은 매일 정해진 시간에 수행된다는 가정하에 짜여진 것이다.

### 제조사 사이트에서 수집하는 경우

1. DB에 이미지가 없는 데이터가 있다면, 데이터를 수집했던 상세 페이지로 가서 이미지가 업데이트 되었는지 확인한다.
2. 이미지가 업데이트 되었다면 수집, 아니라면 스킵.
3. 이번달 이후로 일정 기간의 데이터를 수집한 뒤, DB에 데이터가 있는지 조회한다.
4. DB에 데이터가 없으면 수집한다. 더미 이미지는 수집하지 않는다.

### 도매상 사이트에서 수집하는 경우

다양한 제조사의 상품의 발매 예정 정보를 편하게 수집할 수 있다는 장점이 있지만 문제가 있다.

1. 대표 이미지를 수집할 수 없는 경우가 있음.
2. 모든 제조사의 모든 발매 예정 제품을 수집할 수 있는 것이 아님.
3. 고화질 대표 이미지, 상세 이미지를 수집할 수 없음.

위 문제가 있기에 결국 제조사 사이트나 X(구 트위터)를 다시 확인해야 한다.

구글 이미지 검색을 이용하면 되지 않을까 생각했지만 그리 간단하지 않았다.<br>
검색어와 검색하는 사이트를 좁힌 뒤, 첫 번째 이미지를 가져오는 것으로 시험해 보았다. 결과는 아래와 같았다.<br>

1. 정확한 이미지가 검색되는 경우
2. 비슷한 상품의 이미지가 검색되는 경우
3. 아예 엉뚱한 이미지가 검색되는 경우
4. 이미지를 찾을 수 없는 경우

결론: 검색 후에도 인간이 판단해야 한다. 차라리 수동으로 하는 게 나을지도.

# 앞으로 하고 싶은 것

## 데이터 번역하기

당장 계획하고 있는 것은 이 데이터를 번역하는 것이다. 열심히 모은 정보를 되도록 많은 사람과 나누고 싶다.<br>
deepL API를 이용하여 테스트를 진행했고, 데이터가 어느 정도 모이면 비용을 지불하여 데이터 수집 파이프라인에 추가할 것이다.

## 키워드 추출하기

찜 상품 알림 기능에 필요한 작업이다. 관심 키워드를 지정한 뒤, 키워드와 관련된 상품이 DB에 새로 등록되면 해당 정보를 메일 등으로 알려주는 기능이다.<br>
명사형 키워드를 다룰 예정이며, 키워드 추출에는 형태소 분석을 이용할 생각이다.<br>
특정 작품명이나 캐릭터명은 수동 작업이 필요하겠지만 형태소 분석 결과가 궁금하니 한번 시험해 볼 것이다.
